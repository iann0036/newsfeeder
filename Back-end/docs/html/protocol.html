<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>News Feeder Refresh Daemon (nfrd): Protocol talks to Front-end</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">News Feeder Refresh Daemon (nfrd)
   </div>
   <div id="projectbrief">Back-end of News Feeder - An online news aggregator</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Protocol talks to Front-end </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#protocol_introduction">Introduction</a><ul><li class="level2"><a href="#protocol_introduction_socket">Sockets</a></li>
</ul>
</li>
<li class="level1"><a href="#protocol_login">Login</a><ul><li class="level2"><a href="#protocol_login_success">Success case</a></li>
<li class="level2"><a href="#protocol_login_fail">Fail case</a></li>
</ul>
</li>
<li class="level1"><a href="#protocol_status">status - Check the status</a><ul><li class="level2"><a href="#protocol_status_crawler">crawler - crawler status</a></li>
<li class="level2"><a href="#protocol_status_uptime">uptime - Back-end uptime</a></li>
</ul>
</li>
<li class="level1"><a href="#protocol_crawler">crawler - Control the crawler</a><ul><li class="level2"><a href="#protocol_crawler_start">start - Start the crawler</a></li>
<li class="level2"><a href="#protocol_crawler_status">status - Check the status of the crawler</a></li>
<li class="level2"><a href="#protocol_crawler_stop">stop - Stop the crawler</a></li>
</ul>
</li>
<li class="level1"><a href="#protocol_config">config - Configure back-end</a><ul><li class="level2"><a href="#protocol_config_add">add - Add/Change an attribute</a></li>
<li class="level2"><a href="#protocol_config_get">get - Return an attribute</a></li>
<li class="level2"><a href="#protocol_config_load">load - Load configuration file</a></li>
<li class="level2"><a href="#protocol_config_save">save - Save configuration file</a></li>
</ul>
</li>
<li class="level1"><a href="#protocol_shutdown">shutdown - Shutdown the Back-End</a></li>
<li class="level1"><a href="#protocol_quit">quit - Close connection</a></li>
<li class="level1"><a href="#protocol_unknown">Unknown command handling</a></li>
<li class="level1"><a href="#protocol_example">Examples</a><ul><li class="level2"><a href="#protocol_example_crawler_restart">Restart the crawler</a></li>
<li class="level2"><a href="#protocol_example_crawler_change_thread">Change the number of thread in crawler</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><dl class="section author"><dt>Author:</dt><dd>Shiwei Zhang <a href="#" onclick="location.href='mai'+'lto:'+'sz6'+'53'+'@uo'+'w.'+'edu'+'.a'+'u'; return false;">sz653<span style="display: none;">.nosp@m.</span>@uow<span style="display: none;">.nosp@m.</span>.edu.<span style="display: none;">.nosp@m.</span>au</a> </dd></dl>
<dl class="section date"><dt>Date:</dt><dd>01/05/12 </dd></dl>
<dl class="section version"><dt>Version:</dt><dd>0.2</dd></dl>
<h1><a class="anchor" id="protocol_introduction"></a>
Introduction</h1>
<p>This page contains protocol definition that talks to the front-end of News Feeder.<br/>
 For this version of protocol, the protocol is <b>plaintext</b> which is more readable for human beings but less efficient and security. In the next version of this protocol will based on binary which is more efficient but less human readable.<br/>
 In later versions, the protocol will be encapsulated by a security layer. </p>
<dl class="section warning"><dt>Warning:</dt><dd>The protocol details may be changed during development because we are adding news features and implementation issues.</dd></dl>
<h2><a class="anchor" id="protocol_introduction_socket"></a>
Sockets</h2>
<p>The back-end listens to both unix socket and tcp socket as defined by the config file. The user could turn off unix socket listening or tcp socket listening by modifying the config file.<br/>
 Basically, for a server that installed both front-end and back-end, unix socket is suggested and turn of the tcp socket in order to prevent external attacks. On the hand, if front-end and back-end are installed in different servers, tcp socket is suggested and turn of the unix socket.</p>
<h1><a class="anchor" id="protocol_login"></a>
Login</h1>
<p>Before the front-end could communicate with and control back-end, it should login first and be authenticated in order to provide basic security. The front-end must provide a username and password for authentication.</p>
<h2><a class="anchor" id="protocol_login_success"></a>
Success case</h2>
<div align="center">
<img src="msc_inline_mscgraph_1.png" alt="msc_inline_mscgraph_1" border="0" usemap="#msc_inline_mscgraph_1.map"/>
<map name="msc_inline_mscgraph_1.map" id="msc_inline_mscgraph_1.map"></map>
</div>
<h2><a class="anchor" id="protocol_login_fail"></a>
Fail case</h2>
<div align="center">
<img src="msc_inline_mscgraph_2.png" alt="msc_inline_mscgraph_2" border="0" usemap="#msc_inline_mscgraph_2.map"/>
<map name="msc_inline_mscgraph_2.map" id="msc_inline_mscgraph_2.map"></map>
</div>
<h1><a class="anchor" id="protocol_status"></a>
status - Check the status</h1>
<p>The front-end can check the status of the back-end via "status" and combine sub-commands as following: </p>
<div class="fragment"><div class="line">        status [sub-command]</div>
</div><!-- fragment --><p> If sub-command is not provide, the back-end will send a brief string to the front-end. This string may not be parsed by the front-end but is human readable. </p>
<div align="center">
<img src="msc_inline_mscgraph_3.png" alt="msc_inline_mscgraph_3" border="0" usemap="#msc_inline_mscgraph_3.map"/>
<map name="msc_inline_mscgraph_3.map" id="msc_inline_mscgraph_3.map"></map>
</div>
<p> In the later version, statistical information will be available.</p>
<h2><a class="anchor" id="protocol_status_crawler"></a>
crawler - crawler status</h2>
<p>This sub-command "crawler" will tell whether the crawler is running or not.<br/>
 If the crawler is currently running, it will return "running": </p>
<div align="center">
<img src="msc_inline_mscgraph_4.png" alt="msc_inline_mscgraph_4" border="0" usemap="#msc_inline_mscgraph_4.map"/>
<map name="msc_inline_mscgraph_4.map" id="msc_inline_mscgraph_4.map"></map>
</div>
<p> If the crawler is currently stopped, it will return "stopped": </p>
<div align="center">
<img src="msc_inline_mscgraph_5.png" alt="msc_inline_mscgraph_5" border="0" usemap="#msc_inline_mscgraph_5.map"/>
<map name="msc_inline_mscgraph_5.map" id="msc_inline_mscgraph_5.map"></map>
</div>
<p> Note: There are 4 statuses: running, stopped, stopping and starting.</p>
<h2><a class="anchor" id="protocol_status_uptime"></a>
uptime - Back-end uptime</h2>
<p>This sub-command "uptime" will return back how many seconds that the back-end has run. For example: (has run for 1 hour) </p>
<div align="center">
<img src="msc_inline_mscgraph_6.png" alt="msc_inline_mscgraph_6" border="0" usemap="#msc_inline_mscgraph_6.map"/>
<map name="msc_inline_mscgraph_6.map" id="msc_inline_mscgraph_6.map"></map>
</div>
<h1><a class="anchor" id="protocol_crawler"></a>
crawler - Control the crawler</h1>
<p>The crawler command in this version of protocol is under the assumption that the back-end is only running one crawler (since the back-end is designed to handle multiple crawler at one time).<br/>
 Same as command <a class="el" href="protocol.html#protocol_status">status - Check the status</a>, this command is used with sub-commands while a sub-command is required. For example: </p>
<div align="center">
<img src="msc_inline_mscgraph_7.png" alt="msc_inline_mscgraph_7" border="0" usemap="#msc_inline_mscgraph_7.map"/>
<map name="msc_inline_mscgraph_7.map" id="msc_inline_mscgraph_7.map"></map>
</div>
<p> If no sub-command is attached to the command "crawler", the back-end will return a "fail" as following: </p>
<div align="center">
<img src="msc_inline_mscgraph_8.png" alt="msc_inline_mscgraph_8" border="0" usemap="#msc_inline_mscgraph_8.map"/>
<map name="msc_inline_mscgraph_8.map" id="msc_inline_mscgraph_8.map"></map>
</div>
<h2><a class="anchor" id="protocol_crawler_start"></a>
start - Start the crawler</h2>
<p>This sub-command "start" tells the back-end to start the crawler: </p>
<div align="center">
<img src="msc_inline_mscgraph_9.png" alt="msc_inline_mscgraph_9" border="0" usemap="#msc_inline_mscgraph_9.map"/>
<map name="msc_inline_mscgraph_9.map" id="msc_inline_mscgraph_9.map"></map>
</div>
<p> If exceptions are thrown and caught by the back-end, it will return a "fail" with error message followed by a ": ": </p>
<div align="center">
<img src="msc_inline_mscgraph_10.png" alt="msc_inline_mscgraph_10" border="0" usemap="#msc_inline_mscgraph_10.map"/>
<map name="msc_inline_mscgraph_10.map" id="msc_inline_mscgraph_10.map"></map>
</div>
<h2><a class="anchor" id="protocol_crawler_status"></a>
status - Check the status of the crawler</h2>
<p>This sub-command "status" is exactly the same as command "status crawler". </p>
<dl class="section see"><dt>See also:</dt><dd><a class="el" href="protocol.html#protocol_status_crawler">crawler - crawler status</a></dd></dl>
<h2><a class="anchor" id="protocol_crawler_stop"></a>
stop - Stop the crawler</h2>
<p>This sub-command "stop" tells the back-end to stop the crawler: </p>
<div align="center">
<img src="msc_inline_mscgraph_11.png" alt="msc_inline_mscgraph_11" border="0" usemap="#msc_inline_mscgraph_11.map"/>
<map name="msc_inline_mscgraph_11.map" id="msc_inline_mscgraph_11.map"></map>
</div>
<p> If exceptions are thrown and caught by the back-end, it will return a "fail" with error message followed by a ": ": </p>
<div align="center">
<img src="msc_inline_mscgraph_12.png" alt="msc_inline_mscgraph_12" border="0" usemap="#msc_inline_mscgraph_12.map"/>
<map name="msc_inline_mscgraph_12.map" id="msc_inline_mscgraph_12.map"></map>
</div>
<h1><a class="anchor" id="protocol_config"></a>
config - Configure back-end</h1>
<p>The "config" command provide the direct control of the config information at the back-end. Like <a class="el" href="protocol.html#protocol_crawler">crawler - Control the crawler</a>, a sub-command is required when using this command. </p>
<div align="center">
<img src="msc_inline_mscgraph_13.png" alt="msc_inline_mscgraph_13" border="0" usemap="#msc_inline_mscgraph_13.map"/>
<map name="msc_inline_mscgraph_13.map" id="msc_inline_mscgraph_13.map"></map>
</div>
 <dl class="section see"><dt>See also:</dt><dd>config::ConfigManager</dd></dl>
<h2><a class="anchor" id="protocol_config_add"></a>
add - Add/Change an attribute</h2>
<p>This sub-command "add" tells the back-end to add or change an attribute. The grammar for this command is: </p>
<div class="fragment"><div class="line">        config add sector attribute value</div>
</div><!-- fragment --><p> The sector and attribute should not contain whitespaces. It will take everything after attribute as the value of that attribute. For example: </p>
<div align="center">
<img src="msc_inline_mscgraph_14.png" alt="msc_inline_mscgraph_14" border="0" usemap="#msc_inline_mscgraph_14.map"/>
<map name="msc_inline_mscgraph_14.map" id="msc_inline_mscgraph_14.map"></map>
</div>
<p> In this example, "mysql" is parsed as sector name, "password" is parsed as attribute name, and "hello world" is parsed as its value. This command may fail (because of memory problem or others) and it will return a "fail" with error message followed by a ": ": </p>
<div align="center">
<img src="msc_inline_mscgraph_15.png" alt="msc_inline_mscgraph_15" border="0" usemap="#msc_inline_mscgraph_15.map"/>
<map name="msc_inline_mscgraph_15.map" id="msc_inline_mscgraph_15.map"></map>
</div>
<p> If the required sector or attribute does not exist, it will automatically add a new one. If the attribute is already there, the back-end will change it.</p>
<h2><a class="anchor" id="protocol_config_get"></a>
get - Return an attribute</h2>
<p>This sub-command "get" tells the back-end to get the value of an attribute. The grammar for this command is: </p>
<div class="fragment"><div class="line">        config <span class="keyword">get</span> sector attribute</div>
</div><!-- fragment --><p> The back-end will search for this attribute as requested. if request is successful, the back-end will return "success". Otherwise, it will return "fail", followed by an error message. Once success, the front-end can get the value back by sending "transmit". </p>
<div align="center">
<img src="msc_inline_mscgraph_16.png" alt="msc_inline_mscgraph_16" border="0" usemap="#msc_inline_mscgraph_16.map"/>
<map name="msc_inline_mscgraph_16.map" id="msc_inline_mscgraph_16.map"></map>
</div>
<p> Of course, the front-end can cancel this by sending "cancel" or rubbish. </p>
<div align="center">
<img src="msc_inline_mscgraph_17.png" alt="msc_inline_mscgraph_17" border="0" usemap="#msc_inline_mscgraph_17.map"/>
<map name="msc_inline_mscgraph_17.map" id="msc_inline_mscgraph_17.map"></map>
</div>
<p> Also, here is the situation if the sector or the attribute is not available: </p>
<div align="center">
<img src="msc_inline_mscgraph_18.png" alt="msc_inline_mscgraph_18" border="0" usemap="#msc_inline_mscgraph_18.map"/>
<map name="msc_inline_mscgraph_18.map" id="msc_inline_mscgraph_18.map"></map>
</div>
<h2><a class="anchor" id="protocol_config_load"></a>
load - Load configuration file</h2>
<p>This sub-command "load" tells the back-end to load all configurations from a config file. The grammar for this command is: </p>
<div class="fragment"><div class="line">        config load [file]</div>
</div><!-- fragment --><p> where "file" is optional. Note: The default config file is "nfrd.conf" which is hard coded in the nfrd program. It will return "success" on success or "fail" followed by error message on failure.<br/>
 Success case: </p>
<div align="center">
<img src="msc_inline_mscgraph_19.png" alt="msc_inline_mscgraph_19" border="0" usemap="#msc_inline_mscgraph_19.map"/>
<map name="msc_inline_mscgraph_19.map" id="msc_inline_mscgraph_19.map"></map>
</div>
<p> Fail case: </p>
<div align="center">
<img src="msc_inline_mscgraph_20.png" alt="msc_inline_mscgraph_20" border="0" usemap="#msc_inline_mscgraph_20.map"/>
<map name="msc_inline_mscgraph_20.map" id="msc_inline_mscgraph_20.map"></map>
</div>
 <dl class="section see"><dt>See also:</dt><dd><a class="el" href="namespacenfrd_1_1misc_1_1_utility.html#ab7db4e58020bbda83d200c437704dec7" title="Read the content of the url and write to the container.">config::ConfigManager::Read()</a></dd></dl>
<h2><a class="anchor" id="protocol_config_save"></a>
save - Save configuration file</h2>
<p>This sub-command "save" tells the back-end to save all configurations to a config file. The grammar for this command is: </p>
<div class="fragment"><div class="line">        config save [file]</div>
</div><!-- fragment --><p> where "file" is optional. Note: The default config file is "nfrd.conf" which is hard coded in the nfrd program. It will return "success" on success or "fail" followed by error message on failure.<br/>
 Success case: </p>
<div align="center">
<img src="msc_inline_mscgraph_21.png" alt="msc_inline_mscgraph_21" border="0" usemap="#msc_inline_mscgraph_21.map"/>
<map name="msc_inline_mscgraph_21.map" id="msc_inline_mscgraph_21.map"></map>
</div>
<p> Fail case: </p>
<div align="center">
<img src="msc_inline_mscgraph_22.png" alt="msc_inline_mscgraph_22" border="0" usemap="#msc_inline_mscgraph_22.map"/>
<map name="msc_inline_mscgraph_22.map" id="msc_inline_mscgraph_22.map"></map>
</div>
 <dl class="section see"><dt>See also:</dt><dd>config::ConfigManager::Write()</dd></dl>
<h1><a class="anchor" id="protocol_shutdown"></a>
shutdown - Shutdown the Back-End</h1>
<p>Shutdown the Back-End process in a safe way. Stopping all modules and unload them then terminate itself. Success case: </p>
<div align="center">
<img src="msc_inline_mscgraph_23.png" alt="msc_inline_mscgraph_23" border="0" usemap="#msc_inline_mscgraph_23.map"/>
<map name="msc_inline_mscgraph_23.map" id="msc_inline_mscgraph_23.map"></map>
</div>
<p> Fail case: </p>
<div align="center">
<img src="msc_inline_mscgraph_24.png" alt="msc_inline_mscgraph_24" border="0" usemap="#msc_inline_mscgraph_24.map"/>
<map name="msc_inline_mscgraph_24.map" id="msc_inline_mscgraph_24.map"></map>
</div>
 <dl class="section warning"><dt>Warning:</dt><dd>This command should be used for maintenance only.</dd></dl>
<h1><a class="anchor" id="protocol_quit"></a>
quit - Close connection</h1>
<p>After all communication with the back-end, the front-end should say good-bye, which is "quit" in this case, to the back-end to close the connection between them. </p>
<div align="center">
<img src="msc_inline_mscgraph_25.png" alt="msc_inline_mscgraph_25" border="0" usemap="#msc_inline_mscgraph_25.map"/>
<map name="msc_inline_mscgraph_25.map" id="msc_inline_mscgraph_25.map"></map>
</div>
<h1><a class="anchor" id="protocol_unknown"></a>
Unknown command handling</h1>
<p>If a command is not supported by the back-end, a message of "unknown command" will be returned. </p>
<div align="center">
<img src="msc_inline_mscgraph_26.png" alt="msc_inline_mscgraph_26" border="0" usemap="#msc_inline_mscgraph_26.map"/>
<map name="msc_inline_mscgraph_26.map" id="msc_inline_mscgraph_26.map"></map>
</div>
<h1><a class="anchor" id="protocol_example"></a>
Examples</h1>
<p>Here is some examples for advanced operations.</p>
<h2><a class="anchor" id="protocol_example_crawler_restart"></a>
Restart the crawler</h2>
<div align="center">
<img src="msc_inline_mscgraph_27.png" alt="msc_inline_mscgraph_27" border="0" usemap="#msc_inline_mscgraph_27.map"/>
<map name="msc_inline_mscgraph_27.map" id="msc_inline_mscgraph_27.map"></map>
</div>
 <h2><a class="anchor" id="protocol_example_crawler_change_thread"></a>
Change the number of thread in crawler</h2>
<div align="center">
<img src="msc_inline_mscgraph_28.png" alt="msc_inline_mscgraph_28" border="0" usemap="#msc_inline_mscgraph_28.map"/>
<map name="msc_inline_mscgraph_28.map" id="msc_inline_mscgraph_28.map"></map>
</div>
 </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Oct 18 2012 22:03:06 for News Feeder Refresh Daemon (nfrd) by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.1.1
</small></address>
</body>
</html>
